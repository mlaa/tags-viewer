(function(h){h.fn.sheetrock=function(w){var w=q(h.extend({},h.fn.sheetrock.options,w),this);if(!w){return this}g(w)};var g=function(w){if(k(w,"queued")){w=w.queued}if(k(w,"cached")){w.queued=w.cached}if(w.loading){w.loading.show()}if(w.chunkSize&&w.target){w.sql+=" limit "+(w.chunkSize+1)+" offset "+w.offset;h.data(w.target[0],r,w.offset+w.chunkSize)}w.callback="sheetrock_"+i++;h.fn.sheetrock.working++;var x=l(w);h.ajax({data:x,context:w,url:"https://spreadsheets.google.com/tq",dataType:"jsonp",cache:true,jsonp:false,jsonpCallback:w.callback,success:function(y){if(u(y)){this.dataHandler(y,this)}else{if(this.target){h.data(this.target[0],m,1)}}if(this.loading){this.loading.hide()}if(this.userCallback){this.userCallback(this)}h.fn.sheetrock.working--}});return this};var i=0;var u=function(w){if(k(w,"status")&&(w.status==="ok"||w.status==="warning")&&k(w,"table")){if(k(w,"warnings")){h.each(w.warnings,function(x,y){p(y)})}return true}else{if(k(w,"errors")){h.each(w.errors,function(y,x){p(x.message);p(x.detailed_message)})}return false}};var e=function(z,x){if(x.debug){p(z)}var y=(x.chunkSize)?Math.min(z.table.rows.length,x.chunkSize):z.table.rows.length;var w=(!x.chunkSize||y<x.chunkSize)?1:0;if(x.target){h.data(x.target[0],c,w)}var A=(x.labels&&x.labels.length==z.table.cols.length)?x.labels:h.map(z.table.cols,j);if(!x.headers){x.target.append(x.rowHandler(s(A),0))}h.each(z.table.rows,function(C,D){if(k(D,"c")&&C<y){var B={num:x.offset+C+1,cells:{}};h.each(D.c,function(F,E){var G=(x.formatting)?n(E):false;var H=(E&&k(E,"v"))?x.cellHandler(E.v):"";B.cells[A[F]]=(G)?a(H,"span",G):H});x.target.append(x.rowHandler(B))}})};var b=function(w){h.each(w.table.cols,function(y,x){h.fn.sheetrock.labels[x.id]=(k(x,"label"))?x.label.replace(/ /g,""):x.id});return true};var q=function(y,z){y.key=d(y.url)||false;y.gid=t(y.url)||false;y.chunkSize=(z.length)?parseInt(y.chunkSize)||0:0;y.offset=(y.chunkSize)?parseInt(h.data(z[0],r))||0:0;y.headers=parseInt(y.headers)||0;y.target=(z.length)?z:false;var x=(z.length)?parseInt(h.data(z[0],c))||0:0;var w=(z.length)?parseInt(h.data(z[0],m))||0:0;if(y.loading&&!(y.loading instanceof jQuery)){y.loading=h(y.loading)}if(!z.length&&y.dataHandler===e){p("Error: No element targeted or data handler provided.");return false}else{if(x){p("Halt: No more rows to load!");return false}else{if(w){p("Halt: A previous request for this resource failed.");return false}else{if(!y.url){p("Error: No spreadsheet URL provided.");return false}else{if(!y.key){p("Error: Could not find a key in the provided URL.");return false}else{if(!y.gid){p("Error: Could not find a gid in the provided URL.");return false}else{if(y.sql&&h.isEmptyObject(h.fn.sheetrock.labels)){p("Fetching column labels.");if(y.loading){y.loading.show()}y=h.extend({},y,{sql:"",chunkSize:1,offset:0,loading:false,target:false,dataHandler:b,userCallback:g,cached:y})}}}}}}}if(y.debug){p(y)}return y};var l=function(w){var x={key:w.key,gid:w.gid,tqx:"responseHandler:"+w.callback};if(w.sql){x.tq=f(w.sql)}return x};var o=function(w){return w.toString().replace(/^ +/,"").replace(/ +$/,"")};var k=function(w,x){return(typeof w[x]==="undefined")?false:true};var p=function(w){console.log(w)};var d=function(x){var w=new RegExp("key=([a-z0-9]{30,})&?","i");return(w.test(x))?x.match(w)[1]:false};var t=function(w){var x=new RegExp("gid=([0-9]+)","i");return(x.test(w))?w.match(x)[1]:false};var j=function(w){return(k(obj,"label"))?w.label.replace(/ /g,""):w.id};var f=function(w){h.each(h.fn.sheetrock.labels,function(x,y){w=w.replace(new RegExp("%"+y+"%","g"),x)});return w};var s=function(w){var x={};h.each(w,function(y,z){x[z]=z});return x};var n=function(w){return(w&&k(w,"p")&&k(w.p,"style"))?w.p.style:false};var v=function(y){var x="",w=(y.num)?"td":"th";for(prop in y.cells){x+=a(y.cells[prop],w,"")}return a(x,"tr","")};var a=function(z,x,y){var w=(y)?' style="'+y+'"':"";return"<"+x+w+">"+z+"</"+x+">"};var m="sheetrock-error",c="sheetrock-loaded",r="sheetrock-row-offset";h.fn.sheetrock.options={url:"",headers:0,labels:[],formatting:false,chunkSize:0,debug:false,sql:"",rowHandler:v,cellHandler:o,dataHandler:e,userCallback:false,loading:false};h.fn.sheetrock.labels={};h.fn.sheetrock.working=0})(jQuery);