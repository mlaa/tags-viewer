(function(q){q.fn.sheetrock=function(O,P){O.target=(this.length)?this:false;O=J(O);if(O){if(j(P)&&P!==null){L(O,P)}else{G(O)}}return this};var v={},o=[],w=0,n="sheetrockError",B="sheetrockLoaded",M="sheetrockRowOffset",G=function(O){o=q.grep(o,g,true);o.push(q.fn.sheetrock.promise);q.fn.sheetrock.promise=q.fn.sheetrock.promise.pipe(function(){return h(O)}).pipe(function(){return y(O)})},L=function(O,P){f(O);E.call(O,P);t.call(O)},h=function(O){var P={sql:"select * limit 1",dataHandler:u,userCallback:q.noop,target:false};if(O.sql.indexOf("%")!==-1&&q.isEmptyObject(O.columns)){c("Prefetching column labels.");return y(q.extend({},O,P))}else{return new q.Deferred().resolve()}},y=function(O){f(O);if(O.chunkSize&&O.target){O.sql+=" limit "+(O.chunkSize+1)+" offset "+O.offset;r(O.target,M,O.offset+O.chunkSize)}O.callback="sheetrock_"+w++;var P={data:e(O),context:O,url:q.fn.sheetrock.server,dataType:"jsonp",cache:true,jsonp:false,jsonpCallback:O.callback};c(P,O.debug);return q.ajax(P).done(E).fail(d).always(t)},f=function(O){O.loading.show();q.fn.sheetrock.working++},E=function(O){K(O,"warnings");K(O,"errors");c(O,this.debug);if(b(O,"status","table")&&b(O.table,"cols","rows")){this.dataHandler.call(m.call(this,O),O)}else{d.call(this,O)}},d=function(){r(this.target,n,1);c("Request failed.")},t=function(){this.loading.hide();this.userCallback(this);q.fn.sheetrock.working--},K=function(P,O){if(b(P,O)){q.each(P[O],function(R,Q){if(b(Q,"detailed_message")){c(Q.detailed_message)}else{if(b(Q,"message")){c(Q.message)}}})}},m=function(P){var O=this;O.parsed={};O.parsed.last=(O.chunkSize)?Math.min(P.table.rows.length,O.chunkSize):P.table.rows.length;O.parsed.loaded=(!O.chunkSize||O.parsed.last<O.chunkSize)?1:0;O.parsed.header=(q.map(P.table.cols,F).length)?1:0;O.parsed.labels=(O.labels&&O.labels.length===P.table.cols.length)?O.labels:q.map(P.table.cols,N);r(O.target,B,O.parsed.loaded);return O},l=function(P){var O=this;if(!O.offset&&!O.headersOff){if(O.parsed.header||!O.headers){O.target.append(O.rowHandler({num:0,cells:I(O.parsed.labels)}))}}q.each(P.table.rows,function(S,T){if(b(T,"c")&&S<O.parsed.last){var R=k(O.offset+S+1+O.parsed.header-O.headers),Q={num:R,cells:{}};if(R||!O.headersOff){q.each(T.c,function(V,U){var W=(O.formatting)?D(U):false,X=(U&&b(U,"v"))?O.cellHandler(U.v):"";Q.cells[O.parsed.labels[V]]=(W)?A(X,"span",W):X});O.target.append(O.rowHandler(Q))}}})},u=function(O){var P={};q.each(O.table.cols,function(R,Q){P[Q.id]=N(Q)});v[this.key+this.gid]=P},J=function(O){O=q.extend({},q.fn.sheetrock.options,O);O.key=i(O.url);O.gid=z(O.url);O.chunkSize=(O.target)?k(O.chunkSize):0;O.headers=k(O.headers);O.columns=v[O.key+O.gid]||O.columns||{};O.offset=(O.chunkSize)?H(O.target,M):0;O.loading=s(O.loading);if(!O.target&&O.dataHandler===l){return c("No element targeted or data handler provided.")}else{if(H(O.target,B)){return c("No more rows to load!")}else{if(H(O.target,n)){return c("A previous request for this resource failed.")}else{if(!O.url){return c("No spreadsheet URL provided.")}else{if(!O.key){return c("Could not find a key in the provided URL.")}else{if(!O.gid){return c("Could not find a gid in the provided URL.")}}}}}}c(O,O.debug);return O},e=function(O){var P={key:O.key,gid:O.gid,tqx:"responseHandler:"+O.callback};if(O.sql){P.tq=p(O.sql,v[O.key+O.gid]||O.columns)}return P},a=function(O){return O.toString().replace(/^ +/,"").replace(/ +$/,"")},k=function(O){return Math.max(0,parseInt(O,10)||0)},b=function(P){for(var O=1;O<arguments.length;O++){if(!j(P[arguments[O]])){return false}}return true},j=function(O){return(typeof O==="undefined")?false:true},c=function(P,O){O=!j(O)||(j(O)&&O);if(O&&window.console&&console.log){console.log(P)}return false},H=function(P,O){return(P.length)?q.data(P[0],O)||0:0},r=function(P,O,Q){return(P.length)?q.data(P[0],O,Q)||0:0},i=function(P){var O=new RegExp("key=([a-z0-9]{30,})&?","i");return(O.test(P))?P.match(O)[1]:false},z=function(O){var P=new RegExp("gid=([0-9]+)","i");return(P.test(O))?O.match(P)[1]:false},C=function(O){return(b(O,"label"))?O.label.replace(/\s/g,""):false},F=function(O){return C(O)||null},N=function(O){return C(O)||O.id},g=function(O){return O.state()==="resolved"},p=function(P,O){q.each(O,function(Q,R){P=P.replace(new RegExp("%"+R+"%","g"),Q)});return P},s=function(O){return(O&&!(O instanceof jQuery))?q(O):O},I=function(O){var P={};q.each(O,function(Q,R){P[R]=R});return P},D=function(O){return(O&&b(O,"p")&&b(O.p,"style"))?O.p.style:false},x=function(Q){var R,P="",O=(Q.num)?"td":"th";for(R in Q.cells){if(b(Q.cells,R)){P+=A(Q.cells[R],O,"")}}return A(P,"tr","")},A=function(R,P,Q){var O=(Q)?' style="'+Q+'"':"";return"<"+P+O+">"+R+"</"+P+">"};q.fn.sheetrock.options={url:"",sql:"",chunkSize:0,columns:{},labels:[],rowHandler:x,cellHandler:a,dataHandler:l,userCallback:q.noop,loading:q(),debug:false,headers:0,headersOff:false,formatting:false};q.fn.sheetrock.server="https://spreadsheets.google.com/tq";q.fn.sheetrock.working=0;q.fn.sheetrock.promise=new q.Deferred().resolve()})(jQuery);
